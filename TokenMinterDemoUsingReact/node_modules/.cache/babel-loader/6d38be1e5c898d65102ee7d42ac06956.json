{"ast":null,"code":"\"use strict\";\n\nvar __values = this && this.__values || function (o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n      i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar ethUtil = require(\"ethereumjs-util\");\n\nvar DEFAULT_ADDRESS_SEARCH_LIMIT = 1000;\n\nvar DerivedHDKeyInfoIterator =\n/** @class */\nfunction () {\n  function DerivedHDKeyInfoIterator(initialDerivedKey, searchLimit) {\n    if (searchLimit === void 0) {\n      searchLimit = DEFAULT_ADDRESS_SEARCH_LIMIT;\n    }\n\n    this._searchLimit = searchLimit;\n    this._parentDerivedKeyInfo = initialDerivedKey;\n    this._index = 0;\n  }\n\n  DerivedHDKeyInfoIterator.prototype.next = function () {\n    var baseDerivationPath = this._parentDerivedKeyInfo.baseDerivationPath;\n    var derivationIndex = this._index;\n    var fullDerivationPath = \"m/\" + baseDerivationPath + \"/\" + derivationIndex;\n    var path = \"m/\" + derivationIndex;\n\n    var hdKey = this._parentDerivedKeyInfo.hdKey.derive(path);\n\n    var address = exports.walletUtils.addressOfHDKey(hdKey);\n    var derivedKey = {\n      address: address,\n      hdKey: hdKey,\n      baseDerivationPath: baseDerivationPath,\n      derivationPath: fullDerivationPath\n    };\n    var isDone = this._index === this._searchLimit;\n    this._index++;\n    return {\n      done: isDone,\n      value: derivedKey\n    };\n  };\n\n  DerivedHDKeyInfoIterator.prototype[Symbol.iterator] = function () {\n    return this;\n  };\n\n  return DerivedHDKeyInfoIterator;\n}();\n\nexports.walletUtils = {\n  calculateDerivedHDKeyInfos: function (parentDerivedKeyInfo, numberOfKeys) {\n    var e_1, _a;\n\n    var derivedKeys = [];\n    var derivedKeyIterator = new DerivedHDKeyInfoIterator(parentDerivedKeyInfo, numberOfKeys);\n\n    try {\n      for (var derivedKeyIterator_1 = __values(derivedKeyIterator), derivedKeyIterator_1_1 = derivedKeyIterator_1.next(); !derivedKeyIterator_1_1.done; derivedKeyIterator_1_1 = derivedKeyIterator_1.next()) {\n        var key = derivedKeyIterator_1_1.value;\n        derivedKeys.push(key);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (derivedKeyIterator_1_1 && !derivedKeyIterator_1_1.done && (_a = derivedKeyIterator_1.return)) _a.call(derivedKeyIterator_1);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n\n    return derivedKeys;\n  },\n  findDerivedKeyInfoForAddressIfExists: function (address, parentDerivedKeyInfo, searchLimit) {\n    var e_2, _a;\n\n    var lowercaseAddress = address.toLowerCase();\n    var matchedKey;\n    var derivedKeyIterator = new DerivedHDKeyInfoIterator(parentDerivedKeyInfo, searchLimit);\n\n    try {\n      for (var derivedKeyIterator_2 = __values(derivedKeyIterator), derivedKeyIterator_2_1 = derivedKeyIterator_2.next(); !derivedKeyIterator_2_1.done; derivedKeyIterator_2_1 = derivedKeyIterator_2.next()) {\n        var key = derivedKeyIterator_2_1.value;\n\n        if (key.address === lowercaseAddress) {\n          matchedKey = key;\n          break;\n        }\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (derivedKeyIterator_2_1 && !derivedKeyIterator_2_1.done && (_a = derivedKeyIterator_2.return)) _a.call(derivedKeyIterator_2);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    return matchedKey;\n  },\n  addressOfHDKey: function (hdKey) {\n    var shouldSanitizePublicKey = true;\n    var derivedPublicKey = hdKey.publicKey;\n    var ethereumAddressUnprefixed = ethUtil.publicToAddress(derivedPublicKey, shouldSanitizePublicKey).toString('hex');\n    var address = ethUtil.addHexPrefix(ethereumAddressUnprefixed).toLowerCase();\n    return address;\n  }\n};","map":{"version":3,"sources":["../../../src/utils/wallet_utils.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __values = (this && this.__values) || function (o) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\n    if (m) return m.call(o);\n    return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ethUtil = require(\"ethereumjs-util\");\nvar DEFAULT_ADDRESS_SEARCH_LIMIT = 1000;\nvar DerivedHDKeyInfoIterator = /** @class */ (function () {\n    function DerivedHDKeyInfoIterator(initialDerivedKey, searchLimit) {\n        if (searchLimit === void 0) { searchLimit = DEFAULT_ADDRESS_SEARCH_LIMIT; }\n        this._searchLimit = searchLimit;\n        this._parentDerivedKeyInfo = initialDerivedKey;\n        this._index = 0;\n    }\n    DerivedHDKeyInfoIterator.prototype.next = function () {\n        var baseDerivationPath = this._parentDerivedKeyInfo.baseDerivationPath;\n        var derivationIndex = this._index;\n        var fullDerivationPath = \"m/\" + baseDerivationPath + \"/\" + derivationIndex;\n        var path = \"m/\" + derivationIndex;\n        var hdKey = this._parentDerivedKeyInfo.hdKey.derive(path);\n        var address = exports.walletUtils.addressOfHDKey(hdKey);\n        var derivedKey = {\n            address: address,\n            hdKey: hdKey,\n            baseDerivationPath: baseDerivationPath,\n            derivationPath: fullDerivationPath,\n        };\n        var isDone = this._index === this._searchLimit;\n        this._index++;\n        return {\n            done: isDone,\n            value: derivedKey,\n        };\n    };\n    DerivedHDKeyInfoIterator.prototype[Symbol.iterator] = function () {\n        return this;\n    };\n    return DerivedHDKeyInfoIterator;\n}());\nexports.walletUtils = {\n    calculateDerivedHDKeyInfos: function (parentDerivedKeyInfo, numberOfKeys) {\n        var e_1, _a;\n        var derivedKeys = [];\n        var derivedKeyIterator = new DerivedHDKeyInfoIterator(parentDerivedKeyInfo, numberOfKeys);\n        try {\n            for (var derivedKeyIterator_1 = __values(derivedKeyIterator), derivedKeyIterator_1_1 = derivedKeyIterator_1.next(); !derivedKeyIterator_1_1.done; derivedKeyIterator_1_1 = derivedKeyIterator_1.next()) {\n                var key = derivedKeyIterator_1_1.value;\n                derivedKeys.push(key);\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (derivedKeyIterator_1_1 && !derivedKeyIterator_1_1.done && (_a = derivedKeyIterator_1.return)) _a.call(derivedKeyIterator_1);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        return derivedKeys;\n    },\n    findDerivedKeyInfoForAddressIfExists: function (address, parentDerivedKeyInfo, searchLimit) {\n        var e_2, _a;\n        var lowercaseAddress = address.toLowerCase();\n        var matchedKey;\n        var derivedKeyIterator = new DerivedHDKeyInfoIterator(parentDerivedKeyInfo, searchLimit);\n        try {\n            for (var derivedKeyIterator_2 = __values(derivedKeyIterator), derivedKeyIterator_2_1 = derivedKeyIterator_2.next(); !derivedKeyIterator_2_1.done; derivedKeyIterator_2_1 = derivedKeyIterator_2.next()) {\n                var key = derivedKeyIterator_2_1.value;\n                if (key.address === lowercaseAddress) {\n                    matchedKey = key;\n                    break;\n                }\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (derivedKeyIterator_2_1 && !derivedKeyIterator_2_1.done && (_a = derivedKeyIterator_2.return)) _a.call(derivedKeyIterator_2);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        return matchedKey;\n    },\n    addressOfHDKey: function (hdKey) {\n        var shouldSanitizePublicKey = true;\n        var derivedPublicKey = hdKey.publicKey;\n        var ethereumAddressUnprefixed = ethUtil\n            .publicToAddress(derivedPublicKey, shouldSanitizePublicKey)\n            .toString('hex');\n        var address = ethUtil.addHexPrefix(ethereumAddressUnprefixed).toLowerCase();\n        return address;\n    },\n};\n//# sourceMappingURL=wallet_utils.js.map"]},"metadata":{},"sourceType":"script"}