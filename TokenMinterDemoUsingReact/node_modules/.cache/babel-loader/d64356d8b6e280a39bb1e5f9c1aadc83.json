{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar utils_1 = require(\"@0x/utils\");\n\nvar ethereum_types_1 = require(\"ethereum-types\");\n\nvar ethUtil = require(\"ethereumjs-util\");\n\nvar _ = require(\"lodash\");\n\nvar utils_2 = require(\"./utils\");\n/**\n * Utils to convert ethereum structures from user-space format to RPC format. (marshall/unmarshall)\n */\n\n\nexports.marshaller = {\n  /**\n   * Unmarshall block without transaction data\n   * @param blockWithHexValues block to unmarshall\n   * @return unmarshalled block without transaction data\n   */\n  unmarshalIntoBlockWithoutTransactionData: function (blockWithHexValues) {\n    var block = __assign({}, blockWithHexValues, {\n      gasLimit: utils_2.utils.convertHexToNumber(blockWithHexValues.gasLimit),\n      gasUsed: utils_2.utils.convertHexToNumber(blockWithHexValues.gasUsed),\n      size: utils_2.utils.convertHexToNumber(blockWithHexValues.size),\n      timestamp: utils_2.utils.convertHexToNumber(blockWithHexValues.timestamp),\n      number: blockWithHexValues.number === null ? null : utils_2.utils.convertHexToNumber(blockWithHexValues.number),\n      difficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.difficulty),\n      totalDifficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.totalDifficulty)\n    });\n\n    return block;\n  },\n\n  /**\n   * Unmarshall block with transaction data\n   * @param blockWithHexValues block to unmarshall\n   * @return unmarshalled block with transaction data\n   */\n  unmarshalIntoBlockWithTransactionData: function (blockWithHexValues) {\n    var block = __assign({}, blockWithHexValues, {\n      gasLimit: utils_2.utils.convertHexToNumber(blockWithHexValues.gasLimit),\n      gasUsed: utils_2.utils.convertHexToNumber(blockWithHexValues.gasUsed),\n      size: utils_2.utils.convertHexToNumber(blockWithHexValues.size),\n      timestamp: utils_2.utils.convertHexToNumber(blockWithHexValues.timestamp),\n      number: blockWithHexValues.number === null ? null : utils_2.utils.convertHexToNumber(blockWithHexValues.number),\n      difficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.difficulty),\n      totalDifficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.totalDifficulty),\n      transactions: []\n    });\n\n    block.transactions = _.map(blockWithHexValues.transactions, function (tx) {\n      var transaction = exports.marshaller.unmarshalTransaction(tx);\n      return transaction;\n    });\n    return block;\n  },\n\n  /**\n   * Unmarshall transaction\n   * @param txRpc transaction to unmarshall\n   * @return unmarshalled transaction\n   */\n  unmarshalTransaction: function (txRpc) {\n    var tx = __assign({}, txRpc, {\n      blockNumber: txRpc.blockNumber !== null ? utils_2.utils.convertHexToNumber(txRpc.blockNumber) : null,\n      transactionIndex: txRpc.transactionIndex !== null ? utils_2.utils.convertHexToNumber(txRpc.transactionIndex) : null,\n      nonce: utils_2.utils.convertHexToNumber(txRpc.nonce),\n      gas: utils_2.utils.convertHexToNumber(txRpc.gas),\n      gasPrice: utils_2.utils.convertAmountToBigNumber(txRpc.gasPrice),\n      value: utils_2.utils.convertAmountToBigNumber(txRpc.value)\n    });\n\n    return tx;\n  },\n\n  /**\n   * Unmarshall transaction receipt\n   * @param txReceiptRpc transaction receipt to unmarshall\n   * @return unmarshalled transaction receipt\n   */\n  unmarshalTransactionReceipt: function (txReceiptRpc) {\n    var txReceipt = __assign({}, txReceiptRpc, {\n      blockNumber: utils_2.utils.convertHexToNumber(txReceiptRpc.blockNumber),\n      transactionIndex: utils_2.utils.convertHexToNumber(txReceiptRpc.transactionIndex),\n      cumulativeGasUsed: utils_2.utils.convertHexToNumber(txReceiptRpc.cumulativeGasUsed),\n      gasUsed: utils_2.utils.convertHexToNumber(txReceiptRpc.gasUsed),\n      logs: _.map(txReceiptRpc.logs, exports.marshaller.unmarshalLog.bind(exports.marshaller))\n    });\n\n    return txReceipt;\n  },\n\n  /**\n   * Unmarshall transaction data\n   * @param txDataRpc transaction data to unmarshall\n   * @return unmarshalled transaction data\n   */\n  unmarshalTxData: function (txDataRpc) {\n    if (txDataRpc.from === undefined) {\n      throw new Error(\"txData must include valid 'from' value.\");\n    }\n\n    var txData = __assign({}, txDataRpc, {\n      value: txDataRpc.value !== undefined ? utils_2.utils.convertAmountToBigNumber(txDataRpc.value) : undefined,\n      gas: txDataRpc.gas !== undefined ? utils_2.utils.convertHexToNumber(txDataRpc.gas) : undefined,\n      gasPrice: txDataRpc.gasPrice !== undefined ? utils_2.utils.convertAmountToBigNumber(txDataRpc.gasPrice) : undefined,\n      nonce: txDataRpc.nonce !== undefined ? utils_2.utils.convertHexToNumber(txDataRpc.nonce) : undefined\n    });\n\n    return txData;\n  },\n\n  /**\n   * Marshall transaction data\n   * @param txData transaction data to marshall\n   * @return marshalled transaction data\n   */\n  marshalTxData: function (txData) {\n    if (txData.from === undefined) {\n      throw new Error(\"txData must include valid 'from' value.\");\n    }\n\n    var callTxDataBase = __assign({}, txData);\n\n    delete callTxDataBase.from;\n\n    var callTxDataBaseRPC = exports.marshaller._marshalCallTxDataBase(callTxDataBase);\n\n    var txDataRPC = __assign({}, callTxDataBaseRPC, {\n      from: exports.marshaller.marshalAddress(txData.from)\n    });\n\n    var prunableIfUndefined = ['gasPrice', 'gas', 'value', 'nonce'];\n\n    _.each(txDataRPC, function (value, key) {\n      if (value === undefined && _.includes(prunableIfUndefined, key)) {\n        delete txDataRPC[key];\n      }\n    });\n\n    return txDataRPC;\n  },\n\n  /**\n   * Marshall call data\n   * @param callData call data to marshall\n   * @return marshalled call data\n   */\n  marshalCallData: function (callData) {\n    var callTxDataBase = __assign({}, callData);\n\n    delete callTxDataBase.from;\n\n    var callTxDataBaseRPC = exports.marshaller._marshalCallTxDataBase(callTxDataBase);\n\n    var callDataRPC = __assign({}, callTxDataBaseRPC, {\n      from: callData.from === undefined ? undefined : exports.marshaller.marshalAddress(callData.from)\n    });\n\n    return callDataRPC;\n  },\n\n  /**\n   * Marshall address\n   * @param address address to marshall\n   * @return marshalled address\n   */\n  marshalAddress: function (address) {\n    if (utils_1.addressUtils.isAddress(address)) {\n      return ethUtil.addHexPrefix(address);\n    }\n\n    throw new Error(\"Invalid address encountered: \" + address);\n  },\n\n  /**\n   * Marshall block param\n   * @param blockParam block param to marshall\n   * @return marshalled block param\n   */\n  marshalBlockParam: function (blockParam) {\n    if (blockParam === undefined) {\n      return ethereum_types_1.BlockParamLiteral.Latest;\n    }\n\n    var encodedBlockParam = _.isNumber(blockParam) ? utils_2.utils.numberToHex(blockParam) : blockParam;\n    return encodedBlockParam;\n  },\n\n  /**\n   * Unmarshall log\n   * @param rawLog log to unmarshall\n   * @return unmarshalled log\n   */\n  unmarshalLog: function (rawLog) {\n    var formattedLog = __assign({}, rawLog, {\n      logIndex: utils_2.utils.convertHexToNumberOrNull(rawLog.logIndex),\n      blockNumber: utils_2.utils.convertHexToNumberOrNull(rawLog.blockNumber),\n      transactionIndex: utils_2.utils.convertHexToNumberOrNull(rawLog.transactionIndex)\n    });\n\n    return formattedLog;\n  },\n  _marshalCallTxDataBase: function (callTxDataBase) {\n    var callTxDataBaseRPC = __assign({}, callTxDataBase, {\n      to: callTxDataBase.to === undefined ? undefined : exports.marshaller.marshalAddress(callTxDataBase.to),\n      gasPrice: callTxDataBase.gasPrice === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.gasPrice),\n      gas: callTxDataBase.gas === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.gas),\n      value: callTxDataBase.value === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.value),\n      nonce: callTxDataBase.nonce === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.nonce)\n    });\n\n    return callTxDataBaseRPC;\n  }\n};","map":{"version":3,"sources":["../../src/marshaller.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = require(\"@0x/utils\");\nvar ethereum_types_1 = require(\"ethereum-types\");\nvar ethUtil = require(\"ethereumjs-util\");\nvar _ = require(\"lodash\");\nvar utils_2 = require(\"./utils\");\n/**\n * Utils to convert ethereum structures from user-space format to RPC format. (marshall/unmarshall)\n */\nexports.marshaller = {\n    /**\n     * Unmarshall block without transaction data\n     * @param blockWithHexValues block to unmarshall\n     * @return unmarshalled block without transaction data\n     */\n    unmarshalIntoBlockWithoutTransactionData: function (blockWithHexValues) {\n        var block = __assign({}, blockWithHexValues, { gasLimit: utils_2.utils.convertHexToNumber(blockWithHexValues.gasLimit), gasUsed: utils_2.utils.convertHexToNumber(blockWithHexValues.gasUsed), size: utils_2.utils.convertHexToNumber(blockWithHexValues.size), timestamp: utils_2.utils.convertHexToNumber(blockWithHexValues.timestamp), number: blockWithHexValues.number === null ? null : utils_2.utils.convertHexToNumber(blockWithHexValues.number), difficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.difficulty), totalDifficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.totalDifficulty) });\n        return block;\n    },\n    /**\n     * Unmarshall block with transaction data\n     * @param blockWithHexValues block to unmarshall\n     * @return unmarshalled block with transaction data\n     */\n    unmarshalIntoBlockWithTransactionData: function (blockWithHexValues) {\n        var block = __assign({}, blockWithHexValues, { gasLimit: utils_2.utils.convertHexToNumber(blockWithHexValues.gasLimit), gasUsed: utils_2.utils.convertHexToNumber(blockWithHexValues.gasUsed), size: utils_2.utils.convertHexToNumber(blockWithHexValues.size), timestamp: utils_2.utils.convertHexToNumber(blockWithHexValues.timestamp), number: blockWithHexValues.number === null ? null : utils_2.utils.convertHexToNumber(blockWithHexValues.number), difficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.difficulty), totalDifficulty: utils_2.utils.convertAmountToBigNumber(blockWithHexValues.totalDifficulty), transactions: [] });\n        block.transactions = _.map(blockWithHexValues.transactions, function (tx) {\n            var transaction = exports.marshaller.unmarshalTransaction(tx);\n            return transaction;\n        });\n        return block;\n    },\n    /**\n     * Unmarshall transaction\n     * @param txRpc transaction to unmarshall\n     * @return unmarshalled transaction\n     */\n    unmarshalTransaction: function (txRpc) {\n        var tx = __assign({}, txRpc, { blockNumber: txRpc.blockNumber !== null ? utils_2.utils.convertHexToNumber(txRpc.blockNumber) : null, transactionIndex: txRpc.transactionIndex !== null ? utils_2.utils.convertHexToNumber(txRpc.transactionIndex) : null, nonce: utils_2.utils.convertHexToNumber(txRpc.nonce), gas: utils_2.utils.convertHexToNumber(txRpc.gas), gasPrice: utils_2.utils.convertAmountToBigNumber(txRpc.gasPrice), value: utils_2.utils.convertAmountToBigNumber(txRpc.value) });\n        return tx;\n    },\n    /**\n     * Unmarshall transaction receipt\n     * @param txReceiptRpc transaction receipt to unmarshall\n     * @return unmarshalled transaction receipt\n     */\n    unmarshalTransactionReceipt: function (txReceiptRpc) {\n        var txReceipt = __assign({}, txReceiptRpc, { blockNumber: utils_2.utils.convertHexToNumber(txReceiptRpc.blockNumber), transactionIndex: utils_2.utils.convertHexToNumber(txReceiptRpc.transactionIndex), cumulativeGasUsed: utils_2.utils.convertHexToNumber(txReceiptRpc.cumulativeGasUsed), gasUsed: utils_2.utils.convertHexToNumber(txReceiptRpc.gasUsed), logs: _.map(txReceiptRpc.logs, exports.marshaller.unmarshalLog.bind(exports.marshaller)) });\n        return txReceipt;\n    },\n    /**\n     * Unmarshall transaction data\n     * @param txDataRpc transaction data to unmarshall\n     * @return unmarshalled transaction data\n     */\n    unmarshalTxData: function (txDataRpc) {\n        if (txDataRpc.from === undefined) {\n            throw new Error(\"txData must include valid 'from' value.\");\n        }\n        var txData = __assign({}, txDataRpc, { value: txDataRpc.value !== undefined ? utils_2.utils.convertAmountToBigNumber(txDataRpc.value) : undefined, gas: txDataRpc.gas !== undefined ? utils_2.utils.convertHexToNumber(txDataRpc.gas) : undefined, gasPrice: txDataRpc.gasPrice !== undefined ? utils_2.utils.convertAmountToBigNumber(txDataRpc.gasPrice) : undefined, nonce: txDataRpc.nonce !== undefined ? utils_2.utils.convertHexToNumber(txDataRpc.nonce) : undefined });\n        return txData;\n    },\n    /**\n     * Marshall transaction data\n     * @param txData transaction data to marshall\n     * @return marshalled transaction data\n     */\n    marshalTxData: function (txData) {\n        if (txData.from === undefined) {\n            throw new Error(\"txData must include valid 'from' value.\");\n        }\n        var callTxDataBase = __assign({}, txData);\n        delete callTxDataBase.from;\n        var callTxDataBaseRPC = exports.marshaller._marshalCallTxDataBase(callTxDataBase);\n        var txDataRPC = __assign({}, callTxDataBaseRPC, { from: exports.marshaller.marshalAddress(txData.from) });\n        var prunableIfUndefined = ['gasPrice', 'gas', 'value', 'nonce'];\n        _.each(txDataRPC, function (value, key) {\n            if (value === undefined && _.includes(prunableIfUndefined, key)) {\n                delete txDataRPC[key];\n            }\n        });\n        return txDataRPC;\n    },\n    /**\n     * Marshall call data\n     * @param callData call data to marshall\n     * @return marshalled call data\n     */\n    marshalCallData: function (callData) {\n        var callTxDataBase = __assign({}, callData);\n        delete callTxDataBase.from;\n        var callTxDataBaseRPC = exports.marshaller._marshalCallTxDataBase(callTxDataBase);\n        var callDataRPC = __assign({}, callTxDataBaseRPC, { from: callData.from === undefined ? undefined : exports.marshaller.marshalAddress(callData.from) });\n        return callDataRPC;\n    },\n    /**\n     * Marshall address\n     * @param address address to marshall\n     * @return marshalled address\n     */\n    marshalAddress: function (address) {\n        if (utils_1.addressUtils.isAddress(address)) {\n            return ethUtil.addHexPrefix(address);\n        }\n        throw new Error(\"Invalid address encountered: \" + address);\n    },\n    /**\n     * Marshall block param\n     * @param blockParam block param to marshall\n     * @return marshalled block param\n     */\n    marshalBlockParam: function (blockParam) {\n        if (blockParam === undefined) {\n            return ethereum_types_1.BlockParamLiteral.Latest;\n        }\n        var encodedBlockParam = _.isNumber(blockParam) ? utils_2.utils.numberToHex(blockParam) : blockParam;\n        return encodedBlockParam;\n    },\n    /**\n     * Unmarshall log\n     * @param rawLog log to unmarshall\n     * @return unmarshalled log\n     */\n    unmarshalLog: function (rawLog) {\n        var formattedLog = __assign({}, rawLog, { logIndex: utils_2.utils.convertHexToNumberOrNull(rawLog.logIndex), blockNumber: utils_2.utils.convertHexToNumberOrNull(rawLog.blockNumber), transactionIndex: utils_2.utils.convertHexToNumberOrNull(rawLog.transactionIndex) });\n        return formattedLog;\n    },\n    _marshalCallTxDataBase: function (callTxDataBase) {\n        var callTxDataBaseRPC = __assign({}, callTxDataBase, { to: callTxDataBase.to === undefined ? undefined : exports.marshaller.marshalAddress(callTxDataBase.to), gasPrice: callTxDataBase.gasPrice === undefined\n                ? undefined\n                : utils_2.utils.encodeAmountAsHexString(callTxDataBase.gasPrice), gas: callTxDataBase.gas === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.gas), value: callTxDataBase.value === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.value), nonce: callTxDataBase.nonce === undefined ? undefined : utils_2.utils.encodeAmountAsHexString(callTxDataBase.nonce) });\n        return callTxDataBaseRPC;\n    },\n};\n//# sourceMappingURL=marshaller.js.map"]},"metadata":{},"sourceType":"script"}